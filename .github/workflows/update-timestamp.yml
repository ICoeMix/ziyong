name: Update File Timestamps

on:
  push:
    branches: [ main ]

jobs:
  update-timestamps:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0   # ç¡®ä¿ git log æœ‰åŽ†å²

      - name: Update timestamps
        run: |
          grep -rl 'âŸ¦TIMESTAMPâŸ§' . | while read FILE; do
            LAST_MOD=$(git log -1 --format=%cd --date=format:'%Y-%m-%d %H:%M' -- "$FILE")
            TIMESTAMP="âŸ¦$LAST_MODâŸ§"
            sed -i "s/âŸ¦TIMESTAMPâŸ§/$TIMESTAMP/g" "$FILE"
            git add "$FILE"
            echo "Updated $FILE -> $TIMESTAMP"
          done

          git diff --cached --quiet || {
            git config user.name "github-actions[bot]"
            git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
            git commit -m "ðŸ•’ Auto update file timestamps"
            git push
          }
